# -*- coding: utf-8 -*-
'''
The boats are positioned on a 10 by 10 grid, which uses algebraic notation for 
the squares ("A" to "J" for the rows and 1 to 10 for the columns).

These are the types of boats each player starts with:

ship | size | symbol
---|---|---
Aircraft Carrier | 5 | "A"
Battleship | 4 | "B"
Destroyer | 3 | "D"
Submarine | 3 | "S"
Patrol Boat | 2 | "P"

Rules:

* Boats are positioned at the start of the game and can't be moved after that.
* On each turn, the current player chooses a square to fire on 
(eg: "F4" for row 5, column 4; 1-based), and the opponent reports 
whether or not it hit one of their ships (and if so, which one).
* If all squares of a ship have been hit, the ship is considered sunk.
* The game ends as soon as one of the players has lost all of their ships.
* Player 1 goes first.
'''
import unittest

def battleshipSalvo(player1Board, player2Board, shotsFired):
    d = {
        "A":"Carrier",
        "B":"Battleship",
        "D":"Destroyer",
        "S":"Submarine",
        "P":"Patrol Boat"
        }
    p1 = {
        "A":5,
        "B":4,
        "D":3,
        "S":3,
        "P":2
        }
    p2 = {
        "A":5,
        "B":4,
        "D":3,
        "S":3,
        "P":2
        }
    i = 0
    attacker = 0
    report = []
    while i < len(shotsFired):
        p = p1 if attacker == 0 else p2
        q = p2 if attacker == 0 else p1
        a = player1Board if attacker == 1 else player2Board
        n = "Player 1 " if attacker == 1 else "Player 2 "
        c = sum([1 for k in p if p[k] > 0])
        print(n,p,q)
        for j in range(i,min(len(shotsFired),i+c)):
            s = shotsFired[j]
            b = attacked(a,s)
            print(s,b)
            if b != ".":
                q[b] -= 1
                if q[b] > 0:
                    report.append(n + d[b] + " hit!")
                elif q[b] == 0:
                    report.append(n + d[b] + " sunk!")
                
                if sum([1 for k in p if q[k] > 0]) == 0:
                    m = "Player 1 " if attacker == 0 else "Player 2 "
                    report.append(m + "wins!")
                    return report
                    
        i += c
        attacker ^= 1
    return report

def attacked(board, shot):
    r = ord(shot[0]) - ord("A")
    c = int("".join(shot[1:])) - 1
    a = board[r][c]
    board[r] = board[r][:c] + "." + board[r][c+1:]
    return a

class CrossieRoadTest(unittest.TestCase):
    def test_1(self):
        player1Board = ["P.........", 
                        "P.........", 
                        "AAAAA.....", 
                        "..........", 
                        "..........", 
                        "..BBBB....", 
                        ".D........", 
                        ".D........", 
                        ".D..SSS...", 
                        ".........."]
        player2Board = ["..........", 
                         "....AS.DDD", 
                         "....AS....", 
                         "....AS....", 
                         "....A.....", 
                         "..B.A.....", 
                         "..B.......", 
                         "..B.......", 
                         "..B.......", 
                         "....PP...."]
        shotsFired = ["J5", 
                      "D4", 
                      "E5", 
                      "J6", 
                      "C7", 
                      "F3", 
                      "J9", 
                      "A10", 
                      "E5", 
                      "B6", 
                      "I2"]
        output = ["Player 2 Patrol Boat hit!", 
                  "Player 2 Carrier hit!", 
                  "Player 2 Patrol Boat sunk!", 
                  "Player 1 Battleship hit!", 
                  "Player 2 Submarine hit!"]
        self.assertEqual(battleshipSalvo(player1Board, player2Board, shotsFired), output)

    def test_2(self):
        player1Board = ["..........", 
                        "..P.......", 
                        "D.P......A", 
                        "D........A", 
                        "DS.......A", 
                        ".S.......A", 
                        ".S.B.....A", 
                        "...B......", 
                        "...B......", 
                        "...B......"]
        player2Board = ["..........", 
                        "..........", 
                        "..........", 
                        "..AAAAA..D", 
                        ".....SSS.D", 
                        ".......PPD", 
                        "........B.", 
                        "........B.", 
                        "........B.", 
                        "........B."]
        shotsFired = ["I6", 
                      "B9", 
                      "D4", 
                      "C2", 
                      "D10", 
                      "J4", 
                      "D1", 
                      "A1", 
                      "H7", 
                      "I9", 
                      "C8", 
                      "B8", 
                      "G9", 
                      "E5", 
                      "C10", 
                      "I10", 
                      "E2", 
                      "A4", 
                      "H3", 
                      "H1"]
        output = ["Player 2 Carrier hit!", 
                  "Player 2 Destroyer hit!", 
                  "Player 1 Battleship hit!", 
                  "Player 1 Destroyer hit!", 
                  "Player 2 Battleship hit!", 
                  "Player 1 Submarine hit!"]
        self.assertEqual(battleshipSalvo(player1Board, player2Board, shotsFired), output)

    def test_3(self):
        player1Board = [".PP.......", 
                        "..........", 
                        "..B.......", 
                        "..B.......", 
                        "..B..SSS..", 
                        "..B.D.....", 
                        "....D.....", 
                        "....D.....", 
                        "..........", 
                        ".....AAAAA"]
        player2Board = ["..........", 
                        "........DB", 
                        "........DB", 
                        ".....S..DB", 
                        ".....S...B", 
                        "....PS....", 
                        "....P.....", 
                        "..........", 
                        "...AAAAA..", 
                        ".........."]
        shotsFired = ["C10", 
                    "E5", 
                    "D2", 
                    "E3", 
                    "B1", 
                    "F2", 
                    "A3", 
                    "E1", 
                    "D10", 
                    "G9", 
                    "A6", 
                    "I5", 
                    "J10", 
                    "G6", 
                    "B7", 
                    "C7", 
                    "I10", 
                    "E10", 
                    "H1", 
                    "D10", 
                    "C5", 
                    "J1", 
                    "G4", 
                    "B3", 
                    "B2", 
                    "G9", 
                    "H3", 
                    "D3", 
                    "J1", 
                    "D7", 
                    "I2", 
                    "I5", 
                    "A2", 
                    "H7", 
                    "F4", 
                    "A8", 
                    "F6", 
                    "F10", 
                    "H8", 
                    "B1", 
                    "C2", 
                    "B8", 
                    "H10", 
                    "D10", 
                    "F4", 
                    "A5", 
                    "B1", 
                    "E4", 
                    "A3", 
                    "I3", 
                    "J4", 
                    "E1", 
                    "I2", 
                    "A10", 
                    "G3", 
                    "F3", 
                    "E9", 
                    "C7", 
                    "F6", 
                    "I8", 
                    "G6", 
                    "J2", 
                    "E10", 
                    "C3", 
                    "B6", 
                    "G4", 
                    "D2", 
                    "A1", 
                    "A7", 
                    "D4", 
                    "G3", 
                    "E3", 
                    "E6", 
                    "G5", 
                    "A4", 
                    "H10", 
                    "E3", 
                    "B4", 
                    "F2", 
                    "B10", 
                    "C10", 
                    "I6", 
                    "C2", 
                    "C2", 
                    "H8", 
                    "G7", 
                    "F2", 
                    "E5", 
                    "D9", 
                    "G10", 
                    "I9", 
                    "B6", 
                    "E7", 
                    "C7", 
                    "E3", 
                    "F6", 
                    "D8", 
                    "F1", 
                    "C7", 
                    "B6", 
                    "C3", 
                    "H6", 
                    "D1", 
                    "D2", 
                    "H1", 
                    "B7", 
                    "J6", 
                    "E8", 
                    "H4", 
                    "D4", 
                    "E9", 
                    "I10", 
                    "C1", 
                    "C6", 
                    "B7", 
                    "H7", 
                    "C9", 
                    "G3", 
                    "D1", 
                    "H1", 
                    "J6", 
                    "E3", 
                    "A6", 
                    "D9", 
                    "E1", 
                    "F6", 
                    "H5", 
                    "E3", 
                    "H6", 
                    "H2", 
                    "E9", 
                    "E4", 
                    "H4", 
                    "F1", 
                    "J10", 
                    "I7", 
                    "J1", 
                    "D6", 
                    "C5", 
                    "F6", 
                    "F6", 
                    "H4", 
                    "I3", 
                    "E8", 
                    "H8", 
                    "G8", 
                    "C2", 
                    "I4", 
                    "F9", 
                    "I4", 
                    "A6", 
                    "B3", 
                    "G8", 
                    "B1", 
                    "A5", 
                    "D6", 
                    "F5", 
                    "D2", 
                    "B3", 
                    "C3", 
                    "J8", 
                    "G8", 
                    "G10", 
                    "H2", 
                    "B7", 
                    "D5", 
                    "E6", 
                    "E4", 
                    "B4", 
                    "I2", 
                    "C10", 
                    "B9", 
                    "J1", 
                    "H7", 
                    "D4", 
                    "G8", 
                    "F5", 
                    "A7", 
                    "H8", 
                    "G9", 
                    "A5", 
                    "D3", 
                    "F10", 
                    "H4", 
                    "J9", 
                    "G2", 
                    "J6", 
                    "E10", 
                    "H9", 
                    "D6", 
                    "B3", 
                    "A10", 
                    "E3", 
                    "I10", 
                    "F8", 
                    "B3", 
                    "H7", 
                    "F8", 
                    "C3", 
                    "C10", 
                    "B8", 
                    "D5", 
                    "E1", 
                    "E5", 
                    "E8", 
                    "D6", 
                    "E9", 
                    "A10", 
                    "I8", 
                    "F9", 
                    "I4", 
                    "C1", 
                    "E2", 
                    "B2", 
                    "J5", 
                    "C4", 
                    "H7", 
                    "H5", 
                    "D4", 
                    "C9", 
                    "F7", 
                    "C8", 
                    "A1", 
                    "C8", 
                    "I10", 
                    "C9", 
                    "B9", 
                    "F1", 
                    "H1", 
                    "H4", 
                    "H10", 
                    "F10", 
                    "A3", 
                    "J9", 
                    "C9", 
                    "C1", 
                    "B4", 
                    "J7", 
                    "A7", 
                    "H4", 
                    "E1", 
                    "D1", 
                    "I3", 
                    "G3", 
                    "E7", 
                    "F2", 
                    "J1", 
                    "E4", 
                    "E10", 
                    "A5", 
                    "B9", 
                    "F10", 
                    "A1", 
                    "F2", 
                    "E4", 
                    "J2", 
                    "F7", 
                    "C10", 
                    "I2", 
                    "B4", 
                    "I9", 
                    "B2", 
                    "H10", 
                    "H10", 
                    "A4", 
                    "C2", 
                    "J10", 
                    "E8", 
                    "E9", 
                    "B4", 
                    "J4", 
                    "A1", 
                    "F8", 
                    "I8", 
                    "J1", 
                    "B10", 
                    "B3", 
                    "J6", 
                    "J10", 
                    "C3", 
                    "B3", 
                    "B10", 
                    "D5", 
                    "A2", 
                    "H10", 
                    "E6", 
                    "H1", 
                    "A7", 
                    "A2", 
                    "J6", 
                    "D9", 
                    "E4", 
                    "B3", 
                    "B3", 
                    "E3", 
                    "E6", 
                    "A8", 
                    "D6", 
                    "F1", 
                    "A4", 
                    "B2", 
                    "C9", 
                    "I10", 
                    "G3", 
                    "A8", 
                    "G7", 
                    "H9", 
                    "I4", 
                    "I4", 
                    "E10", 
                    "D7", 
                    "A3", 
                    "G10", 
                    "F6", 
                    "C3", 
                    "I2", 
                    "E3", 
                    "J6", 
                    "C3", 
                    "G5", 
                    "J3", 
                    "A1", 
                    "J10", 
                    "I3", 
                    "C10", 
                    "C8", 
                    "A5", 
                    "E8", 
                    "G5", 
                    "A3", 
                    "F4", 
                    "B8", 
                    "B2", 
                    "B10", 
                    "F3", 
                    "D10", 
                    "A7", 
                    "E10", 
                    "I7", 
                    "H6", 
                    "D2", 
                    "B5", 
                    "J3", 
                    "G3", 
                    "H7", 
                    "I10", 
                    "D2", 
                    "C1", 
                    "G8", 
                    "I8", 
                    "H10", 
                    "H5", 
                    "D1", 
                    "C10", 
                    "C8", 
                    "A4", 
                    "A6", 
                    "A10", 
                    "C5", 
                    "G7", 
                    "H9", 
                    "F3", 
                    "E7", 
                    "A4", 
                    "J4", 
                    "H7", 
                    "B10", 
                    "B8", 
                    "G2", 
                    "C9", 
                    "G4", 
                    "J4", 
                    "B8", 
                    "H3", 
                    "F8", 
                    "C2", 
                    "B1", 
                    "C6", 
                    "D2", 
                    "H1", 
                    "C6", 
                    "H10", 
                    "J6", 
                    "E3", 
                    "F2", 
                    "G4", 
                    "H7", 
                    "B6", 
                    "C9", 
                    "I4", 
                    "C5", 
                    "B6", 
                    "D6", 
                    "C9", 
                    "F3", 
                    "C1", 
                    "A6", 
                    "H7", 
                    "E6", 
                    "I6", 
                    "B6", 
                    "A1", 
                    "H2", 
                    "J6", 
                    "G5", 
                    "G6", 
                    "E4", 
                    "J8"]
        output = ["Player 2 Battleship hit!", 
                "Player 1 Patrol Boat hit!", 
                "Player 2 Carrier hit!", 
                "Player 1 Battleship hit!", 
                "Player 2 Battleship hit!", 
                "Player 1 Battleship hit!", 
                "Player 2 Battleship hit!", 
                "Player 2 Submarine hit!", 
                "Player 2 Patrol Boat hit!", 
                "Player 1 Battleship hit!", 
                "Player 2 Carrier hit!", 
                "Player 1 Carrier hit!", 
                "Player 1 Submarine hit!", 
                "Player 2 Destroyer hit!", 
                "Player 1 Destroyer hit!", 
                "Player 2 Submarine hit!", 
                "Player 1 Destroyer hit!", 
                "Player 1 Battleship sunk!", 
                "Player 1 Submarine hit!", 
                "Player 2 Destroyer hit!", 
                "Player 1 Carrier hit!", 
                "Player 2 Submarine sunk!", 
                "Player 2 Destroyer sunk!", 
                "Player 1 Carrier hit!", 
                "Player 1 Submarine sunk!", 
                "Player 2 Carrier hit!", 
                "Player 1 Patrol Boat sunk!", 
                "Player 1 Carrier hit!", 
                "Player 1 Destroyer sunk!", 
                "Player 2 Battleship sunk!", 
                "Player 1 Carrier sunk!", 
                "Player 2 wins!"]
        self.assertEqual(battleshipSalvo(player1Board, player2Board, shotsFired), output)

if __name__ == "__main__":
    unittest.main()